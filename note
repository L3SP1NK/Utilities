#!/bin/bash
## Simple todo manager.
## Store your todo in a local text file, archived and encrypted with zip.

## Set colors.
RC="\e[0m"
BOLD="\e[1m"
GREEN="\e[32m"
RED="\e[31m"
BLUE="\e[34m"

WARN="${RED}${BOLD} [-] ${RC}"
INFO="${BLUE}${BOLD} [*] ${RC}"
GOOD="${GREEN}${BOLD} [+] ${RC}"

REQUIREMENTS="shred zip" ## And a CLI editor of your choice.

ENCRYPTED_FILE="${HOME}/.note.zip"
UNCRYPTED_FILE="${HOME}/.note"

RUN()
{
	## Decrypt the files.
	unzip ${ENCRYPTED_FILE}
	## Edit the files.
	${EDITOR} ${UNCRYPTED_FILE}
	## Update the archive.
	zip -durofy ${ENCRYPTED_FILE}
	## Remove the decrypted file.
	shred -zuf ${UNCRYPTED_FILE}
}

if [[ -f ${ENCRYPTED_FILE} ]]
	then
		if ! which ${REQUIREMENTS} > /dev/null
			then
				echo -e "${WARN}To run this program, you need the following packages installed: ${REQUIREMENTS}\n${WARN}Exiting..."
			else
				RUN
		fi
	else
		echo -e "${YELLOW}Note file note not found, do you want to create one? (Y/n)"
		read CREATE_UNCRYPTED_FILE
			case ${CREATE_UNCRYPTED_FILE} in
				Y/y)
					RUN
					;;
				*)
					echo  -e "${WARN}Exiting..."
					exit 1
					;;
			esac
fi
