#!/bin/bash

TIME="date +%H:%M:%S"

function CHECK_DONE()
{
	if [[ ${?} -eq "0" ]]
		then
			${TIME}
			echo -e "\e[32mDone!\e[0m"
		else
			${TIME}
			echo -e "\e[31mSomething went wrong!\e[0m"
	fi
}

function UPDATE_APT()
{
	apt clean -y
	apt autoclean -y
	apt autoremove --purge -y

	dpkg --configure -a
	apt --fix-broken install
	apt --fix-broken

	apt update
	apt upgrade -y

	apt update
	apt dist-upgrade -y

	apt update
	apt full-upgrade -y

	dpkg --configure -a
	apt --fix-broken install
	apt --fix-broken

	apt clean -y
	apt autoclean -y
	apt autoremove --purge -y

}

function TRASH_LOG()
{
	mv -vuf $(find / -type f -name "*.log") ~/.trash
	mv -vuf $(find / -type f -name "*.log*") ~/.trash

	mv -vuf $(find / -type f -name "*.old") ~/.trash
	mv -vuf $(find / -type f -name "*.old*") ~/.trash
}

WORKSPACE=/


# Kill the "enter username prompt" when git pull
function NO_INPUT()
{
	if [[ -t 0 ]]
		then
			stty -echo -icanon time 0 min 0
	fi
}

function UPDATE_GIT()
{
	cd ${WORKSPACE}
	for GIT_PATH in $(find ${WORKSPACE} -type d -name ".git")
		do
			cd ${GIT_PATH};
			echo -e "\n${GIT_PATH}";
			cd ..
			git config pull.rebase false
			git stash
			git pull
			cd ${WORKSPACE}
		done
}

${TIME}
UPDATE_APT
CHECK_DONE
${TIME}
UPDATE_GIT
CHECK_DONE
${TIME}
TRASH_LOG 2>/dev/null
${TIME}
