#!/bin/bash
## Empty swap space and caches.
## Empty the cache of the system and the following applications:
## - Molotov
## - Binance
## - Firefox

## Set colors.
RC="\e[0m"
BOLD="\e[1m"
GREEN="\e[32m"
RED="\e[31m"
BLUE="\e[34m"

WARN="${RED}${BOLD} [-]${RC}"
INFO="${BLUE}${BOLD} [*]${RC}"
GOOD="${GREEN}${BOLD} [+]${RC}"

USER_HOME="/home/lespink"

CACHE_DIR()
{
	if [[ -d /root/.cache ]]
		then
			## Root
			echo -e "${INFO} Removing the root cache directory..."
			rm -fr /root/.cache 2>/dev/null
	fi

	if [[ -d ${USER_HOME}/.cache ]]
		then
			## User
			echo -e "${INFO} Removing the user cache directory..."
			rm -fr ${USER_HOME}/.cache 2>/dev/null
	fi

	if [[ -d ${USER_HOME}/.mozilla/firefox/*/cache ]]
		then
			## Mozilla
			echo -e "${INFO} Removing the firefox cache directory..."
			rm -fr ${USER_HOME}/.mozilla/firefox/*/cache* 2>/dev/null
	fi

	if [[ -d ${USER_HOME}/.config/Binance/Partitions/binance.app/Cache/ ]]
		then
			## Binance
			echo -e "${INFO} Removing the Binance cache directory..."
			rm -fr ${USER_HOME}/.config/Binance/Partitions/binance.app/Cache/* 2>/dev/null
	fi

	if [[ -d ${USER_HOME}/.config/molotov/Cache/ ]]
		then
			## Molotov
			echo -e "${INFO} Removing the Molotov cache directory..."
			rm -fr ${USER_HOME}/.config/molotov/Cache/* 2>/dev/null
	fi

	if [[ -d ${USER_HOME}/.local/share/TelegramDesktop/tdata/ ]]
		then
			## Telegram
			echo -e "${INFO} Removing the Telegram cache directory..."
			rm -fr ${USER_HOME}/.local/share/TelegramDesktop/tdata/user*/ 2>/dev/null
	fi

}

SWAP_SPACE()
{
	sync
	swapoff -a
	swapon -a
	echo 3>/proc/sys/vm/drop_caches
}

## Check privileges.
if [ "$EUID" -ne "0" ]
    then
        echo -e "${WARN} This script must be run as root!\n${WARN} Exiting..."
        exit 1
	else
		echo -e "${WARN} Please close all application currently running and press [ENTER]"
		read
		echo -e "${INFO} Synchronizing cache writes to persistent storage and emptying the swap space..."
		CACHE_DIR
			if [[ $(swapon --show) == "" ]]
				then
					echo -e "${WARN} Swap device not found on this system."
				else
					echo -e "${INFO} Emptying swap space..."
					SWAP_SPACE
			fi
fi
