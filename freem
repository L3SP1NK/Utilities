#!/bin/bash
## Empty swap space and caches.
## Empty the cache of the system and the following applications:
## - Molotov
## - Binance
## - Firefox

RC="\e[0m"
BOLD="\e[1m"
BLUE="\e[34m"
RED="\e[31m"
GREEN="\e[32m"
YELLOW="\e[33m"

USER_HOME="/home/lespink"

CACHE_DIR()
{
	if [[ -d /root/.cache ]]
		then
			## Root
			echo -e "${YELLOW}Removing the ${BOLD}root ${RC}${YELLOW}cache directory...${RC}"
			rm -fr /root/.cache 2>/dev/null
	fi

	if [[ -d ${USER_HOME}/.cache ]]
		then
			## User
			echo -e "${YELLOW}Removing the ${BOLD}user ${RC}${YELLOW}cache directory...${RC}"
			rm -fr ${USER_HOME}/.cache 2>/dev/null
	fi

	if [[ -d ${USER_HOME}/.mozilla/firefox/*/cache ]]
		then
			## Mozilla
			echo -e "${YELLOW}Removing the ${BOLD}firefox ${RC}${YELLOW}cache directory...${RC}"
			rm -fr ${USER_HOME}/.mozilla/firefox/*/cache* 2>/dev/null
	fi

	if [[ -d ${USER_HOME}/.config/Binance/Partitions/binance.app/Cache/ ]]
		then
			## Binance
			echo -e "${YELLOW}Removing the ${BOLD}Binance ${RC}${YELLOW}cache directory...${RC}"
			rm -fr ${USER_HOME}/.config/Binance/Partitions/binance.app/Cache/* 2>/dev/null
	fi

	if [[ -d ${USER_HOME}/.config/molotov/Cache/ ]]
		then
			## Molotov
			echo -e "${YELLOW}Removing the ${BOLD}Molotov ${RC}${YELLOW}cache directory...${RC}"
			rm -fr ${USER_HOME}/.config/molotov/Cache/* 2>/dev/null
	fi

	if [[ -d ${USER_HOME}/.local/share/TelegramDesktop/tdata/ ]]
		then
			## Telegram
			echo -e "${YELLOW}Removing the ${BOLD}Telegram ${RC}${YELLOW}cache directory...${RC}"
			rm -fr ${USER_HOME}/.local/share/TelegramDesktop/tdata/user*/ 2>/dev/null
	fi

}

SWAP_SPACE()
{
	sync
	swapoff -av
	swapon -av
	echo 3>/proc/sys/vm/drop_caches
}

## Check privileges.
if [ "$EUID" -ne "0" ]
    then
        echo -e "${RED}This script must be run as root!\nExiting...${RC}"
        exit 1
	else
		echo -e "${RED}Please close all application currently running and press [ENTER]${RC}"
		read
		echo -e "${YELLOW}Synchronizing cache writes to persistent storage and emptying the swap space...${RC}\n"
		CACHE_DIR
			if [[ $(swapon --show) == "" ]]
				then
					echo -e "${RED}Swap device not found on this system.${RC}"
				else
					echo -e "${YELLOW}Emptying ${BOLD}swap ${RC}${YELLOW}space...${RC}"
					SWAP_SPACE
			fi
fi
